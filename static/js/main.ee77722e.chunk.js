(this.webpackJsonpfront=this.webpackJsonpfront||[]).push([[0],{315:function(e,t,n){e.exports=n(647)},340:function(e,t){},342:function(e,t){},415:function(e,t,n){},447:function(e,t){},449:function(e,t){},476:function(e,t){},478:function(e,t){},479:function(e,t){},484:function(e,t){},486:function(e,t){},505:function(e,t){},517:function(e,t){},520:function(e,t){},644:function(e,t,n){},647:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),i=n(50),o=n.n(i),l=n(103),s=n(17),c=n(23),u=n.n(c),p=n(43),h=n(66),d=n(105),m=n(106),f=n(113),v=n(112),E=n(107),g=n.n(E),b=n(654),S=n(648),C=n(655),x=n(293),w=n.n(x),y=n(63),k=n.n(y),I=n(28);n(415);function M(e){var t=e.size,n=void 0===t?window.innerWidth:t,a=e.points,i=e.pointerX,o=e.pointerY,l=e.maxTilt,s=n/2;function c(e){return parseInt(function(e){return e>l?l:e<-l?-l:e}(e)*(n/(2*l))+n/2)}return r.a.createElement(I.Stage,{height:n,width:n},r.a.createElement(I.Layer,{style:{margin:"auto"}},r.a.createElement(I.Line,{points:a.map(c),stroke:"#df4b26",strokeWidth:5,tension:0,lineCap:"round",preventDefault:!1}),r.a.createElement(I.Circle,{x:c(i),y:c(o),stroke:"green",radius:s/25,preventDefault:!1}),r.a.createElement(I.Circle,{x:n/2,y:n/2,stroke:"black",radius:s,preventDefault:!1}),r.a.createElement(I.Circle,{x:n/2,y:n/2,stroke:"black",radius:s/4*3,preventDefault:!1}),r.a.createElement(I.Circle,{x:n/2,y:n/2,stroke:"black",radius:s/2,preventDefault:!1}),r.a.createElement(I.Circle,{x:n/2,y:n/2,stroke:"black",radius:s/4,preventDefault:!1}),r.a.createElement(I.Circle,{x:n/2,y:n/2,stroke:"black",radius:1,preventDefault:!1}),r.a.createElement(I.Line,{points:[0,n/2,n,n/2],stroke:"black",preventDefault:!1}),r.a.createElement(I.Line,{points:[n/2,0,n/2,n],stroke:"black",preventDefault:!1})))}var T=n(656),O=n(64),D=n.n(O),P=n(114),F=n.n(P),R=F.a.ExcelFile,j=F.a.ExcelFile.ExcelSheet,q=F.a.ExcelFile.ExcelColumn;var N=function(e){var t=e.results,n=e.points,a=e.button,i={columns:["X","Y"],data:n.reduce((function(e,t,n,a){return n%2===0&&e.push(a.slice(n,n+2)),e}),[])};return r.a.createElement(R,{element:a},r.a.createElement(j,{data:[t],name:"Results"},r.a.createElement(q,{label:"Overal Stability Index",value:"osi"}),r.a.createElement(q,{label:"Overal Stability Desviation",value:"osd"}),r.a.createElement(q,{label:"Antero/Posterior Stability Index",value:"api"}),r.a.createElement(q,{label:"Antero/Posterior Stability Desviation",value:"apd"}),r.a.createElement(q,{label:"Medial/Lateral Stability Index",value:"mli"}),r.a.createElement(q,{label:"Medial/Lateral Stability Desviation",value:"mld"}),r.a.createElement(q,{label:"Zone Percentage A",value:"zpA"}),r.a.createElement(q,{label:"Zone Percentage B",value:"zpB"}),r.a.createElement(q,{label:"Zone Percentage C",value:"zpC"}),r.a.createElement(q,{label:"Zone Percentage D",value:"zpD"}),r.a.createElement(q,{label:"Quadrant Percentage I",value:"qpI"}),r.a.createElement(q,{label:"Quadrant Percentage II",value:"qpII"}),r.a.createElement(q,{label:"Quadrant Percentage III",value:"qpIII"}),r.a.createElement(q,{label:"Quadrant Percentage IV",value:"qpIV"})),r.a.createElement(j,{dataSet:[i],name:"Points"}))};function A(){return(A=Object(p.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,D.a.getItem("points");case 3:if(e.t0=e.sent,e.t0){e.next=6;break}e.t0=[];case 6:return n=e.t0,e.next=9,D.a.setItem("points",[].concat(Object(h.a)(n),[{date:new Date,points:t}]));case 9:alert("Saved!"),e.next=15;break;case 12:e.prev=12,e.t1=e.catch(0),console.error(e.t1);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})))).apply(this,arguments)}function L(e){var t=e.reduce((function(e,t,n){return n%2?{x:e.x,y:e.y+Math.pow(0-parseFloat(t),2)}:{x:e.x+Math.pow(0-parseFloat(t),2),y:e.y}}),{x:0,y:0}),n=t.x,a=t.y;return Math.sqrt((n+a)/(e.length/2)).toPrecision(5)}function z(e){var t=e.reduce((function(e,t,n,a){return n%2?[].concat(Object(h.a)(e),[Math.sqrt(Math.pow(a[n-1],2)+Math.pow(a[n],2))]):e}),[]),n=t.reduce((function(e,t){return e+t}),0)/t.length,a=t.reduce((function(e,t){return e+Math.sqrt(Math.pow(t-n,2))}),0);return parseFloat(a/t.length).toPrecision(5)}function B(e){var t=e.reduce((function(e,t,n){return n%2?e+Math.pow(0-parseFloat(t),2):e}),0);return Math.sqrt(t/(e.length/2)).toPrecision(5)}function G(e){var t=e.reduce((function(e,t,n){return n%2?e+parseFloat(t):e}),0)/(e.length/2),n=e.reduce((function(e,n,a){return a%2?e+Math.sqrt(Math.pow(parseFloat(n)-t,2)):e}),0);return parseFloat(n/(e.length/2)).toPrecision(5)}function Q(e){var t=e.reduce((function(e,t,n){return n%2?e:e+Math.pow(0-parseFloat(t),2)}),0);return Math.sqrt(t/(e.length/2)).toPrecision(5)}function H(e){var t=e.reduce((function(e,t,n){return n%2?e:e+parseFloat(t)}),0)/(e.length/2),n=e.reduce((function(e,n,a){return a%2?e:e+Math.sqrt(Math.pow(parseFloat(n)-t,2))}),0);return parseFloat(n/(e.length/2)).toPrecision(5)}var J=function(e){var t=e.points,n=e.maxTilt,a=e.close,i=function(e,t){var n=e.reduce((function(e,n,a,r){if(!(a%2))return e;var i=Math.sqrt(Math.pow(r[a-1],2)+Math.pow(r[a],2));return i<=t/4?Object.assign(e,{a:e.a+1}):i<=t/4*2?Object.assign(e,{b:e.b+1}):i<=t/4*3?Object.assign(e,{c:e.c+1}):Object.assign(e,{d:e.d+1})}),{a:0,b:0,c:0,d:0});return{a:parseFloat(100*n.a/(e.length/2)).toPrecision(3),b:parseFloat(100*n.b/(e.length/2)).toPrecision(3),c:parseFloat(100*n.c/(e.length/2)).toPrecision(3),d:parseFloat(100*n.d/(e.length/2)).toPrecision(3)}}(t,n),o=function(e){var t=e.reduce((function(e,t,n,a){return n%2?a[n-1]<0&&a[n]<0?Object.assign(e,{a:e.a+1}):a[n-1]>0&&a[n]<0?Object.assign(e,{b:e.b+1}):a[n-1]<0&&a[n]>0?Object.assign(e,{c:e.c+1}):Object.assign(e,{d:e.d+1}):e}),{a:0,b:0,c:0,d:0});return{a:parseFloat(100*t.a/(e.length/2)).toPrecision(3),b:parseFloat(100*t.b/(e.length/2)).toPrecision(3),c:parseFloat(100*t.c/(e.length/2)).toPrecision(3),d:parseFloat(100*t.d/(e.length/2)).toPrecision(3)}}(t),l={osi:L(t),osd:z(t),api:B(t),apd:G(t),mli:Q(t),mld:H(t),zpA:i.a,zpB:i.b,zpC:i.c,zpD:i.d,qpI:o.a,qpII:o.b,qpIII:o.c,qpIV:o.d};return r.a.createElement(T.a,{onClose:function(){return a()},defaultOpen:!0},r.a.createElement(T.a.Header,null,"Results"),r.a.createElement(T.a.Content,{image:!0},r.a.createElement(M,{pointerX:t[t.length-2],pointerY:t[t.length-1],points:t,size:Math.min(window.innerHeight,window.innerWidth)/2,maxTilt:n})),r.a.createElement(T.a.Description,null,r.a.createElement("p",null,"Overal Stability Index: ",l.osi),r.a.createElement("p",null,"Overal Stability Desviation: ",l.osd),r.a.createElement("p",null,"Antero/Posterior Stability Index: ",l.api),r.a.createElement("p",null,"Antero/Posterior Stability Desviation: ",l.apd),r.a.createElement("p",null,"Medial/Lateral Stability Index: ",l.mli),r.a.createElement("p",null,"Medial/Lateral Stability Desviation: ",l.mld),r.a.createElement("p",null,"Zone Percentage: A",i.a,"% B",i.b,"% C",i.c,"% D",i.d,"%"),r.a.createElement("p",null,"Quadrant Percentage: I",o.a,"% II",o.b,"% III",o.c,"% IV",o.d,"%")),r.a.createElement(T.a.Actions,null,r.a.createElement(N,{results:l,points:t,button:r.a.createElement(S.a,null," Export ")}),r.a.createElement(S.a,{color:"black",onClick:function(){return a()}},"Close"),r.a.createElement(S.a,{content:"Save",labelPosition:"right",icon:"save",onClick:function(){return function(e){return A.apply(this,arguments)}(t)},positive:!0})))},W=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this)).radarSize=Math.min(window.innerHeight,window.innerWidth),a.measureInterval=null,a.counterInterval=null,a.getPointer=function(e){var t=e.beta,n=e.gamma,r=parseFloat(n).toPrecision(5),i=parseFloat(t).toPrecision(5);r&&i&&a.setState({orientation:{x:parseFloat(r-a.state.cob.x).toPrecision(5),y:parseFloat(i-a.state.cob.y).toPrecision(5)}})},a.handleGetCenterOfBalance=function(){a.setState({points:[],cob:{x:0,y:0}});var e=setInterval((function(){a.setState({points:[].concat(Object(h.a)(a.state.points),[a.state.orientation.x,a.state.orientation.y])})}),parseInt(1e3/a.state.measureFrequency));setTimeout((function(){clearInterval(e),a.getCenterOfBalance()}),3e3)},a.getCenterOfBalance=function(){var e=a.state.points.reduce((function(e,t,n){return n%2?{x:e.x,y:e.y+parseFloat(t)}:{x:e.x+parseFloat(t),y:e.y}}),{x:0,y:0}),t=e.x,n=e.y,r={x:parseFloat(t/(a.state.points.length/2)).toPrecision(5),y:parseFloat(n/(a.state.points.length/2)).toPrecision(5)};a.setState({cob:r,points:[]})},a.handleError=function(e){console.error(e)},a.handleStartMeasure=function(){a.setState({isRunningMeasure:!0}),parseInt(a.state.timerCount)>0&&(a.setState({initialTimer:a.state.timerCount}),a.counterInterval=setInterval((function(){a.setState({timerCount:a.state.timerCount-1}),a.state.timerCount<=0&&(a.handleStopMeasure(),a.setState({timerCount:a.state.initialTimer}),clearInterval(a.counterInterval))}),1e3)),a.measureInterval=setInterval((function(){a.setState({points:[].concat(Object(h.a)(a.state.points),[a.state.orientation.x,a.state.orientation.y])})}),parseInt(1e3/a.state.measureFrequency))},a.handleStopMeasure=function(){a.counterInterval&&(clearInterval(a.counterInterval),a.setState({timerCount:a.state.initialTimer})),clearInterval(a.measureInterval),a.setState({isRunningMeasure:!1,showResults:!0})},a.handleClearMeasure=function(){return a.setState({points:[]})},a.handleGetMaxTilt=function(){a.setState({maxTilt:0}),window.addEventListener("deviceorientation",a.getMaxTilt,!0),setTimeout((function(){return window.removeEventListener("deviceorientation",a.getMaxTilt,!0)}),5e3)},a.getMaxTilt=function(e){var t=e.beta,n=e.gamma,r=parseFloat(n).toPrecision(5),i=parseFloat(t).toPrecision(5);a.setState({maxTilt:Math.max(a.state.maxTilt,Math.sqrt(r*r+i*i))})},a.handleChangeSeconds=function(e){return a.setState({timerCount:e.target.value})},a.handleShowQRScanner=function(){a.peer=new g.a({trickle:!1}),a.peer.on("error",(function(e){return console.log("error",e)})),a.peer.on("signal",function(){var e=Object(p.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("SIGNAL",JSON.stringify(t)),e.next=3,k.a.post(a.state.qrData,t);case 3:n=e.sent,a.setState({answer:n.data});case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.peer.on("connect",(function(){console.log("CONNECT"),a.setState({isConnectedToHUD:!0})})),a.peer.on("close",(function(){console.log("DISCONNECT"),a.setState({isConnectedToHUD:!1})})),a.peer.on("data",(function(e){var t=JSON.parse(e.toString());switch(t.run){case"startMeasure":a.handleStartMeasure();break;case"stopMeasure":a.handleStopMeasure();break;case"getMaxTilt":a.handleGetMaxTilt();break;case"clearMeasure":a.handleClearMeasure();break;case"getCoB":a.handleGetCenterOfBalance();break;case"changeTimer":a.setState({timerCount:t.runValue});break;case"closeResults":a.setState({showResults:!1})}})),a.setState({showQRScanner:!0})},a.handleScan=function(){var e=Object(p.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=6;break}return a.setState({qrData:t,showQRScanner:!1}),e.next=4,k()(t);case 4:n=e.sent,a.peer.signal(n.data.offer);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),a.handleConnectToDevice=function(){return a.props.history.push("/screen")},a.state={answer:"",data:"",dataToSend:"",qrData:"",orientation:{x:0,y:0},cob:{x:0,y:0},points:[],measureFrequency:50,initialTimer:20,timerCount:20,maxTilt:20,showQRScanner:!1,showResults:!1,isConnectedToHUD:!1,isRunningMeasure:!1},a}return Object(m.a)(n,[{key:"componentDidMount",value:function(){window.addEventListener("deviceorientation",this.getPointer,!0)}},{key:"componentDidUpdate",value:function(){this.state.isConnectedToHUD&&this.peer.send(JSON.stringify(this.state))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,this.state.showQRScanner&&r.a.createElement(w.a,{delay:300,onError:this.handleError,onScan:this.handleScan,style:{width:"100%"}}),r.a.createElement(M,{pointerX:this.state.orientation.x,pointerY:this.state.orientation.y,points:this.state.points,size:this.radarSize,maxTilt:this.state.maxTilt}),r.a.createElement(b.a,{textAlign:"center"},this.state.isRunningMeasure?r.a.createElement(S.a,{fluid:!0,color:"red",onClick:this.handleStopMeasure},"Stop measure"):r.a.createElement(S.a,{fluid:!0,color:"green",onClick:this.handleStartMeasure},"Start measure"),r.a.createElement(S.a,{fluid:!0,color:"orange",onClick:this.handleGetCenterOfBalance},"Get CoB"),r.a.createElement(S.a,{onClick:function(){return e.props.history.push("/list")}},"List Results"),r.a.createElement(S.a,{onClick:this.handleGetMaxTilt},"Get max tilt"),r.a.createElement(S.a,{onClick:this.handleClearMeasure},"Clear measure"),r.a.createElement(C.a,{placeholder:"Time in seconds",onChange:this.handleChangeSeconds}),r.a.createElement(S.a,{onClick:this.handleShowQRScanner},"Connect with screen"),r.a.createElement(S.a,{onClick:this.handleConnectToDevice},"Connect with device"),this.state.timerCount," ",r.a.createElement("br",null),this.state.orientation.x," ",r.a.createElement("br",null),this.state.orientation.y," ",r.a.createElement("br",null),this.state.qrData," ",r.a.createElement("br",null),this.state.data," ",r.a.createElement("br",null),this.state.maxTilt," ",r.a.createElement("br",null)),this.state.showResults&&r.a.createElement(J,{close:function(){return e.setState({showResults:!1,points:[]})},points:this.state.points,maxTilt:this.state.maxTilt}))}}]),n}(r.a.Component),U=Object(s.f)(W),V=n(304),X=n.n(V),Y=function(e){Object(f.a)(n,e);var t=Object(v.a)(n);function n(e){var a;return Object(d.a)(this,n),(a=t.call(this)).handleConnectToDevice=function(){a.peer=new g.a({initiator:!0,trickle:!1}),a.peer.on("error",(function(e){return console.log("error",e)})),a.peer.on("signal",function(){var e=Object(p.a)(u.a.mark((function e(t){var n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("SIGNAL",JSON.stringify(t)),e.next=3,k.a.post("https://e-quilibrium-api.herokuapp.com/",t);case 3:n=e.sent,console.log("SIGNAL",JSON.stringify(n)),a.setState({offer:n.data}),a.getServerAnswer();case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),a.peer.on("connect",(function(){console.log("CONNECT"),a.setState({isConnectedToDevice:!0})})),a.peer.on("close",(function(){console.log("DISCONNECT"),a.setState({isConnectedToDevice:!1}),a.handleConnectToDevice()})),a.peer.on("data",(function(e){a.setState(JSON.parse(e.toString()))}))},a.getServerAnswer=Object(p.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Getting"),e.next=3,k()(a.state.offer);case 3:(t=e.sent).data&&t.data.answer?a.peer.signal(t.data.answer):setTimeout((function(){return a.getServerAnswer()}),1e3);case 5:case"end":return e.stop()}}),e)}))),a.state={answer:"",offer:"",data:"",dataToSend:"",qrData:"",orientation:{x:0,y:0},points:[],measureFrequency:50,timerCount:0,showQRScanner:!1,showResults:!1,isConnectedToDevice:!1,isConnectedToHUD:!1,isRunningMeasure:!1,maxTilt:45},a.radarSize=Math.min(window.innerHeight,window.innerWidth),a}return Object(m.a)(n,[{key:"componentDidMount",value:function(){this.handleConnectToDevice()}},{key:"handleSendRun",value:function(e,t){this.peer.send(JSON.stringify({run:e,runValue:t}))}},{key:"render",value:function(){var e=this;return r.a.createElement("div",null,!this.state.offer&&r.a.createElement("div",null," Generating data to sync... "),this.state.offer&&!this.state.isConnectedToDevice&&r.a.createElement(b.a,null,r.a.createElement(X.a,{value:this.state.offer,includeMargin:!0})),this.state.isConnectedToDevice&&r.a.createElement("div",null,r.a.createElement(M,{pointerX:this.state.orientation.x,pointerY:this.state.orientation.y,points:this.state.points,size:this.radarSize,maxTilt:this.state.maxTilt}),r.a.createElement(b.a,{textAlign:"center"},this.state.isRunningMeasure?r.a.createElement(S.a,{fluid:!0,color:"red",onClick:function(){return e.handleSendRun("stopMeasure")}},"Stop measure"):r.a.createElement(S.a,{fluid:!0,color:"green",onClick:function(){return e.handleSendRun("startMeasure")}},"Start measure"),r.a.createElement(S.a,{fluid:!0,color:"orange",onClick:function(){return e.handleSendRun("getCoB")}},"Get CoB"),r.a.createElement(S.a,{onClick:function(){return e.props.history.push("/list")}},"List Results"),r.a.createElement(S.a,{onClick:function(){return e.handleSendRun("getMaxTilt")}},"Get max tilt"),r.a.createElement(S.a,{onClick:function(){return e.handleSendRun("clearMeasure")}},"Clear measure"),r.a.createElement(C.a,{placeholder:"Time in seconds",onChange:function(t){return e.handleSendRun("changeTimer",t.target.value)}}),r.a.createElement(S.a,{onClick:function(){return e.props.history.push("/")}},"Connect with screen"),this.state.timerCount," ",r.a.createElement("br",null),this.state.orientation.x," ",r.a.createElement("br",null),this.state.orientation.y," ",r.a.createElement("br",null),this.state.qrData," ",r.a.createElement("br",null),this.state.maxTilt," ",r.a.createElement("br",null)),this.state.showResults&&r.a.createElement(J,{close:function(){return e.handleSendRun("closeResults")},points:this.state.points,maxTilt:this.state.maxTilt})))}}]),n}(r.a.Component),Z=Object(s.f)(Y),$=n(172),K=n(657);var _=function(){var e=Object(a.useState)(null),t=Object($.a)(e,2),n=t[0],i=t[1],o=Object(a.useState)([]),l=Object($.a)(o,2),s=l[0],c=l[1];return Object(a.useEffect)((function(){s.length<=0&&D.a.getItem("points").then((function(e){return c(e)})),D.a.setItem("points",s)})),r.a.createElement("div",null,r.a.createElement(K.a,{celled:!0},s.length<=0&&r.a.createElement("div",null," No results saved "),s&&s.map((function(e,t,n){return r.a.createElement(K.a.Item,null,r.a.createElement(K.a.Content,null,r.a.createElement(K.a.Header,null,e.date.toLocaleString("en-GB"))),r.a.createElement(K.a.Content,{floated:"right"},r.a.createElement(S.a,{icon:"trash",onClick:function(){return c(n.filter((function(t){return e!==t})))}}),r.a.createElement(S.a,{icon:"eye",onClick:function(){return i(e.points)}})))}))),n&&r.a.createElement(J,{close:function(){return i(null)},points:n,maxTilt:20}))};function ee(){return r.a.createElement(l.a,null,r.a.createElement(s.c,null,r.a.createElement(s.a,{path:"/list"},r.a.createElement(_,null)),r.a.createElement(s.a,{path:"/screen"},r.a.createElement(Z,null)),r.a.createElement(s.a,{path:"/"},r.a.createElement(U,null))))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(644),n(645);var te=document.getElementById("root");o.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(ee,null)),te),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[315,1,2]]]);
//# sourceMappingURL=main.ee77722e.chunk.js.map